"use strict";(self.webpackChunk_readyplayerme_visage=self.webpackChunk_readyplayerme_visage||[]).push([[742],{"./src/components/Background/Box/Box.component.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{x:function(){return Box}});var _home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),three__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/three/build/three.module.js"),_react_three_fiber__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js"),_excluded=["src"],Box=function Box(_ref){var _ref$src=_ref.src,src=void 0===_ref$src?"":_ref$src,baseProps=(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__.Z)(_ref,_excluded),ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),texture=(0,_react_three_fiber__WEBPACK_IMPORTED_MODULE_3__.D)(three__WEBPACK_IMPORTED_MODULE_4__.TextureLoader,src);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsxs)("mesh",(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_5__.Z)((0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_5__.Z)({ref:ref,castShadow:!0,receiveShadow:!0},baseProps),{},{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("boxBufferGeometry",{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)("meshPhysicalMaterial",{map:texture})]}))};Box.__docgenInfo={description:"",methods:[],displayName:"Box",props:{src:{defaultValue:{value:"''",computed:!1},required:!1}}}},"./src/components/Background/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{l:function(){return BackgroundColor}});__webpack_require__("./node_modules/react/index.js");var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),BackgroundColor=function BackgroundColor(_ref){var color=_ref.color;return(0,jsx_runtime.jsx)("color",{attach:"background",args:[color]})};BackgroundColor.__docgenInfo={description:"",methods:[],displayName:"BackgroundColor"};__webpack_require__("./src/components/Background/Box/Box.component.tsx")},"./src/components/BaseCanvas/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{u:function(){return BaseCanvas}});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),react_three_fiber_esm=(__webpack_require__("./node_modules/react/index.js"),__webpack_require__("./node_modules/@react-three/fiber/dist/react-three-fiber.esm.js")),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),BaseCanvas_module_base_canvas="BaseCanvas_base-canvas__7RHH3",jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),BaseCanvas=function BaseCanvas(_ref){var _ref$children=_ref.children,children=void 0===_ref$children?void 0:_ref$children,_ref$fov=_ref.fov,fov=void 0===_ref$fov?50:_ref$fov,_ref$position=_ref.position,position=void 0===_ref$position?new three_module.Vector3(0,0,5):_ref$position,style=_ref.style,_ref$dpr=_ref.dpr,dpr=void 0===_ref$dpr?[1,2]:_ref$dpr,className=_ref.className;return(0,jsx_runtime.jsx)(react_three_fiber_esm.Xz,{className:"".concat(BaseCanvas_module_base_canvas," ").concat(null!=className?className:""),shadows:!0,gl:{preserveDrawingBuffer:!0},dpr:dpr,camera:{fov:fov,position:position},resize:{scroll:!0,debounce:{scroll:50,resize:0}},style:(0,objectSpread2.Z)((0,objectSpread2.Z)({},style),{},{background:"transparent"}),children:children})};BaseCanvas.__docgenInfo={description:"",methods:[],displayName:"BaseCanvas",props:{children:{defaultValue:{value:"undefined",computed:!0},required:!1},fov:{defaultValue:{value:"50",computed:!1},required:!1},position:{defaultValue:{value:"new Vector3(0, 0, 5)",computed:!1},required:!1},dpr:{defaultValue:{value:"[1, 2]",computed:!1},required:!1}}}},"./src/components/Capture/Capture.component.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_react_three_fiber__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/jsx-runtime.js"),Capture=function Capture(_ref){var trigger=_ref.trigger,settings=_ref.settings,callBack=_ref.callBack,gl=(0,_react_three_fiber__WEBPACK_IMPORTED_MODULE_2__.z)((function(state){return state.gl})),type=(null==settings?void 0:settings.type)||"image/png",quality=(null==settings?void 0:settings.quality)||.1;return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)((function(){if(trigger){var _capture=gl.domElement.toDataURL(type,quality);callBack(_capture)}}),[trigger]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_1__.Fragment,{})};Capture.__docgenInfo={description:"",methods:[],displayName:"Capture"},__webpack_exports__.Z=Capture},"./src/components/Models/FloatingModel/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{q:function(){return FloatingModelContainer}});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),index_673ef987_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js"),Model=__webpack_require__("./src/components/Models/Model/index.ts"),services=__webpack_require__("./src/services/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),FloatingModel=function FloatingModel(_ref){var modelSrc=_ref.modelSrc,_ref$scale=_ref.scale,scale=void 0===_ref$scale?1:_ref$scale,onLoaded=_ref.onLoaded,bloom=_ref.bloom,ref=(0,react.useRef)(null),scene=(0,services.Jr)(modelSrc).scene;return(0,index_673ef987_esm.A)((function(state){var t=state.clock.getElapsedTime();null!=ref&&ref.current&&(ref.current.rotation.y=Math.sin(t/2)/8,ref.current.position.y=(1+Math.sin(t/1.5))/-9)})),(0,jsx_runtime.jsx)(Model.H,{modelRef:ref,scale:scale,scene:scene,onLoaded:onLoaded,bloom:bloom})};FloatingModel.__docgenInfo={description:"",methods:[],displayName:"FloatingModel",props:{scale:{defaultValue:{value:"1.0",computed:!1},required:!1}}};var FloatingModelContainer=function FloatingModelContainer(props){var _useState=(0,react.useState)((0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})),_useState2=(0,slicedToArray.Z)(_useState,2),fallback=_useState2[0],setFallback=_useState2[1];return(0,jsx_runtime.jsx)(react.Suspense,{fallback:fallback,children:(0,jsx_runtime.jsx)(FloatingModel,(0,objectSpread2.Z)((0,objectSpread2.Z)({},props),{},{setModelFallback:setFallback}))})};FloatingModelContainer.__docgenInfo={description:"Contains model to handle suspense fallback.",methods:[],displayName:"FloatingModelContainer"}},"./src/components/Models/Model/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{H:function(){return Model}});var react=__webpack_require__("./node_modules/react/index.js"),services=__webpack_require__("./src/services/index.ts"),index_673ef987_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),esm_react=__webpack_require__("./node_modules/jotai/esm/react.mjs"),regeneratorRuntime=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),Animation_service=__webpack_require__("./src/services/Animation.service.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),SpawnEffect=function SpawnEffect(_ref){var onLoadedEffect=_ref.onLoadedEffect,onLoadedEffectFinish=_ref.onLoadedEffectFinish,ref=(0,react.useRef)(null),_React$useState=react.useState(!0),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),effectRunning=_React$useState2[0],setEffectRunning=_React$useState2[1],mountEffectScene=(0,services.Jr)(onLoadedEffect.src).scene,mountEffectNode=(0,index_673ef987_esm.C)(mountEffectScene).nodes;(0,react.useEffect)((function(){effectRunning||(0,services.DK)(onLoadedEffectFinish)}),[onLoadedEffectFinish,effectRunning]);var spawnEffectMixer=(0,react.useMemo)((0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(){var animationLoadedEffect,mixer,animation;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,(0,Animation_service.$)((null==onLoadedEffect?void 0:onLoadedEffect.animationSrc)||onLoadedEffect.src);case 2:if(animationLoadedEffect=_context.sent,mixer=new three_module.AnimationMixer(mountEffectNode.Scene),animationLoadedEffect){_context.next=7;break}return setEffectRunning(!1),_context.abrupt("return",mixer);case 7:return(animation=mixer.clipAction(animationLoadedEffect)).setLoop(three_module.LoopRepeat,(null==onLoadedEffect?void 0:onLoadedEffect.loop)||1),animation.clampWhenFinished=!0,animation.play(),mixer.addEventListener("finished",(function(){animation.fadeOut(.5),setEffectRunning(!1)})),_context.abrupt("return",mixer);case 13:case"end":return _context.stop()}}),_callee)}))),[mountEffectNode.Scene,null==onLoadedEffect?void 0:onLoadedEffect.animationSrc,null==onLoadedEffect?void 0:onLoadedEffect.loop,onLoadedEffect.src]);return(0,index_673ef987_esm.A)(function(){var _ref3=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee2(state,delta){var _yield$spawnEffectMix;return(0,regeneratorRuntime.Z)().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,spawnEffectMixer;case 2:if(_context2.t1=_yield$spawnEffectMix=_context2.sent,_context2.t0=null===_context2.t1,_context2.t0){_context2.next=6;break}_context2.t0=void 0===_yield$spawnEffectMix;case 6:if(!_context2.t0){_context2.next=10;break}_context2.next=11;break;case 10:_yield$spawnEffectMix.update(delta);case 11:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref3.apply(this,arguments)}}()),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:effectRunning&&(0,jsx_runtime.jsx)("primitive",{modelRef:ref,object:mountEffectScene})})};SpawnEffect.__docgenInfo={description:"",methods:[],displayName:"SpawnEffect"};var SpawnAnimation=function SpawnAnimation(_ref){var avatar=_ref.avatar,onLoadedAnimationFinish=_ref.onLoadedAnimationFinish,onLoadedAnimation=_ref.onLoadedAnimation,_React$useState=react.useState(!0),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),animationRunning=_React$useState2[0],setAnimationRunning=_React$useState2[1];(0,react.useEffect)((function(){animationRunning||(0,services.DK)(onLoadedAnimationFinish)}),[onLoadedAnimationFinish,animationRunning]);var avatarNode=(0,index_673ef987_esm.C)(avatar).nodes,animationMixerAvatar=(0,react.useMemo)((0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(){var mixer,animationClip,animation;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(mixer=new three_module.AnimationMixer(avatarNode.Armature),avatarNode.Armature){_context.next=3;break}return _context.abrupt("return",mixer);case 3:return _context.next=5,(0,Animation_service.$)((null==onLoadedAnimation?void 0:onLoadedAnimation.src)||"");case 5:return animationClip=_context.sent,(animation=mixer.clipAction(animationClip)).setLoop(three_module.LoopRepeat,(null==onLoadedAnimation?void 0:onLoadedAnimation.loop)||1),animation.clampWhenFinished=!0,animation.play(),mixer.addEventListener("finished",(function(){animation.fadeOut(.5),setAnimationRunning(!1)})),_context.abrupt("return",mixer);case 12:case"end":return _context.stop()}}),_callee)}))),[avatarNode.Armature,null==onLoadedAnimation?void 0:onLoadedAnimation.loop,null==onLoadedAnimation?void 0:onLoadedAnimation.src]);return(0,index_673ef987_esm.A)(function(){var _ref3=(0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee2(state,delta){var _yield$animationMixer;return(0,regeneratorRuntime.Z)().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,animationMixerAvatar;case 2:if(_context2.t1=_yield$animationMixer=_context2.sent,_context2.t0=null===_context2.t1,_context2.t0){_context2.next=6;break}_context2.t0=void 0===_yield$animationMixer;case 6:if(!_context2.t0){_context2.next=10;break}_context2.next=11;break;case 10:_yield$animationMixer.update(delta);case 11:case"end":return _context2.stop()}}),_callee2)})));return function(_x,_x2){return _ref3.apply(this,arguments)}}()),(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})};SpawnAnimation.__docgenInfo={description:"",methods:[],displayName:"SpawnAnimation"};var spawnAtom=__webpack_require__("./src/state/spawnAtom.ts"),Spawn=function Spawn(_ref){var _animationProps$onLoa,_animationProps$onLoa2,avatar=_ref.avatar,onSpawnFinish=_ref.onSpawnFinish,animationProps=(0,esm_react.Dv)(spawnAtom.O),usesMountEffect=(0,services.w9)(null==animationProps||null===(_animationProps$onLoa=animationProps.onLoadedEffect)||void 0===_animationProps$onLoa?void 0:_animationProps$onLoa.src),usesMountAnimation=(0,services.w9)(null==animationProps||null===(_animationProps$onLoa2=animationProps.onLoadedAnimation)||void 0===_animationProps$onLoa2?void 0:_animationProps$onLoa2.src),_React$useState=react.useState(usesMountEffect),_React$useState2=(0,slicedToArray.Z)(_React$useState,2),effectRunning=_React$useState2[0],setEffectRunning=_React$useState2[1],_React$useState3=react.useState(usesMountAnimation),_React$useState4=(0,slicedToArray.Z)(_React$useState3,2),animationRunning=_React$useState4[0],setAnimationRunning=_React$useState4[1];(0,react.useEffect)((function(){animationRunning||effectRunning||(0,services.DK)(onSpawnFinish)}),[onSpawnFinish,effectRunning,animationRunning]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[usesMountEffect&&(0,jsx_runtime.jsx)(SpawnEffect,{onLoadedEffect:animationProps.onLoadedEffect,onLoadedEffectFinish:function onLoadedEffectFinish(){setEffectRunning(!1)}}),usesMountAnimation&&(0,jsx_runtime.jsx)(SpawnAnimation,{onLoadedAnimation:animationProps.onLoadedAnimation,avatar:avatar,onLoadedAnimationFinish:function onLoadedAnimationFinish(){setAnimationRunning(!1)}})]})};Spawn.__docgenInfo={description:"",methods:[],displayName:"Spawn"};var Model=function Model(_ref){var scene=_ref.scene,_ref$scale=_ref.scale,scale=void 0===_ref$scale?1:_ref$scale,modelRef=_ref.modelRef,onLoaded=_ref.onLoaded,onSpawnAnimationFinish=_ref.onSpawnAnimationFinish,bloom=_ref.bloom,materials=(0,index_673ef987_esm.C)(scene).materials;return(0,services.Zm)(materials,bloom),scene.traverse((function(object){var node=object;node.isMesh&&(node.castShadow=!0),"SkinnedMesh"===node.type&&(node.receiveShadow=!0)})),(0,react.useEffect)((function(){return(0,services.DK)(onLoaded)}),[scene,materials,onLoaded]),(0,jsx_runtime.jsxs)("group",{ref:modelRef,dispose:null,rotation:[0,0,0],children:[(0,jsx_runtime.jsx)("primitive",{object:scene,scale:scale}),(0,jsx_runtime.jsx)(Spawn,{avatar:scene,onSpawnFinish:onSpawnAnimationFinish})]})};Model.__docgenInfo={description:"",methods:[],displayName:"Model",props:{scale:{defaultValue:{value:"1",computed:!1},required:!1}}}},"./src/components/Models/StaticModel/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{P:function(){return StaticModelContainer}});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),Model=__webpack_require__("./src/components/Models/Model/index.ts"),services=__webpack_require__("./src/services/index.ts"),index_673ef987_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),StaticModel=function StaticModel(_ref){var modelSrc=_ref.modelSrc,modelRef=_ref.modelRef,_ref$scale=_ref.scale,scale=void 0===_ref$scale?1:_ref$scale,setModelFallback=_ref.setModelFallback,onLoaded=_ref.onLoaded,emotion=_ref.emotion,bloom=_ref.bloom,scene=(0,services.Jr)(modelSrc).scene,nodes=(0,index_673ef987_esm.C)(scene).nodes;return(0,services.Kx)(nodes,emotion),(0,services.xD)(nodes,setModelFallback),(0,jsx_runtime.jsx)(Model.H,{modelRef:modelRef,scene:scene,scale:scale,onLoaded:onLoaded,bloom:bloom})};StaticModel.__docgenInfo={description:"",methods:[],displayName:"StaticModel",props:{scale:{defaultValue:{value:"1",computed:!1},required:!1}}};var StaticModelContainer=function StaticModelContainer(props){var _useState=(0,react.useState)((0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})),_useState2=(0,slicedToArray.Z)(_useState,2),fallback=_useState2[0],setFallback=_useState2[1];return(0,jsx_runtime.jsx)(react.Suspense,{fallback:fallback,children:(0,jsx_runtime.jsx)(StaticModel,(0,objectSpread2.Z)({setModelFallback:setFallback},props))})};StaticModelContainer.__docgenInfo={description:"Contains model to handle suspense fallback.",methods:[],displayName:"StaticModelContainer"}},"./src/components/Scene/Environment.component.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{q:function(){return Environment}});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_react_three_drei__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/@react-three/drei/core/Environment.js"),src_services_EnvironmentMap_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/services/EnvironmentMap.service.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react/jsx-runtime.js"),Environment=function Environment(_ref){var environment=_ref.environment,config=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return{files:environment in src_services_EnvironmentMap_service__WEBPACK_IMPORTED_MODULE_1__.s?(0,src_services_EnvironmentMap_service__WEBPACK_IMPORTED_MODULE_1__.G)(environment):environment}}),[environment]);return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_2__.jsx)(_react_three_drei__WEBPACK_IMPORTED_MODULE_3__.qA,{files:config.files})};Environment.__docgenInfo={description:"",methods:[],displayName:"Environment"}},"./src/services/Animation.service.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{$:function(){return loadAnimationClip}});var _home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),three_stdlib__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/three-stdlib/loaders/FBXLoader.js"),three_stdlib__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/three-stdlib/loaders/GLTFLoader.js");function normaliseFbxAnimation(fbx){for(var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,tracks=fbx.animations[index].tracks,i=0;i<tracks.length;i+=1){if(tracks[i].name.includes("mixamorig")&&(tracks[i].name=tracks[i].name.replace("mixamorig","")),tracks[i].name.includes(".position"))for(var j=0;j<tracks[i].values.length;j+=1)tracks[i].values[j]=.01*tracks[i].values[j]}return fbx.animations[index]}var loadBlobFile=function(){var _ref=(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__.Z)().mark((function _callee(blob){var fbxLoader,gltfLoader,buffer;return(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return fbxLoader=new three_stdlib__WEBPACK_IMPORTED_MODULE_2__.y,gltfLoader=new three_stdlib__WEBPACK_IMPORTED_MODULE_3__.E,_context.prev=2,_context.next=5,blob.arrayBuffer();case 5:return buffer=_context.sent,_context.next=8,gltfLoader.parseAsync(buffer,"");case 8:return _context.t0=_context.sent,_context.abrupt("return",{group:_context.t0,isFbx:!1});case 12:return _context.prev=12,_context.t1=_context.catch(2),_context.next=16,fbxLoader.loadAsync(URL.createObjectURL(blob));case 16:return _context.t2=_context.sent,_context.abrupt("return",{group:_context.t2,isFbx:!0});case 18:case"end":return _context.stop()}}),_callee,null,[[2,12]])})));return function loadBlobFile(_x){return _ref.apply(this,arguments)}}(),loadPathFile=function(){var _ref2=(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__.Z)().mark((function _callee2(source){var fbxLoader,gltfLoader;return(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__.Z)().wrap((function _callee2$(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return fbxLoader=new three_stdlib__WEBPACK_IMPORTED_MODULE_2__.y,gltfLoader=new three_stdlib__WEBPACK_IMPORTED_MODULE_3__.E,_context2.prev=2,_context2.next=5,gltfLoader.loadAsync(source);case 5:return _context2.t0=_context2.sent,_context2.abrupt("return",{group:_context2.t0,isFbx:!1});case 9:return _context2.prev=9,_context2.t1=_context2.catch(2),_context2.next=13,fbxLoader.loadAsync(source);case 13:return _context2.t2=_context2.sent,_context2.abrupt("return",{group:_context2.t2,isFbx:!0});case 15:case"end":return _context2.stop()}}),_callee2,null,[[2,9]])})));return function loadPathFile(_x2){return _ref2.apply(this,arguments)}}(),loadAnimationClip=function(){var _ref3=(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__.Z)().mark((function _callee3(source){var animation;return(0,_home_runner_work_visage_visage_node_modules_babel_runtime_helpers_esm_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_1__.Z)().wrap((function _callee3$(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(!(source instanceof Blob)){_context3.next=6;break}return _context3.next=3,loadBlobFile(source);case 3:_context3.t0=_context3.sent,_context3.next=9;break;case 6:return _context3.next=8,loadPathFile(source);case 8:_context3.t0=_context3.sent;case 9:return animation=_context3.t0,_context3.abrupt("return",animation.isFbx?normaliseFbxAnimation(animation.group):animation.group.animations[0]);case 11:case"end":return _context3.stop()}}),_callee3)})));return function loadAnimationClip(_x3){return _ref3.apply(this,arguments)}}()},"./src/services/EnvironmentMap.service.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{G:function(){return getPresetEnvironmentMap},s:function(){return environmentPresets}});var environmentPresets={hub:"hub",sunset:"sunset",dawn:"dawn",night:"night",warehouse:"warehouse",forest:"forest",apartment:"apartment",studio:"studio",city:"city",park:"park",lobby:"lobby"},getPresetEnvironmentMap=function getPresetEnvironmentMap(preset){return"https://readyplayerme-assets.s3.amazonaws.com/environment/".concat(preset,".hdr")}},"./src/services/index.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{uZ:function(){return clamp},gT:function(){return getStoryAssetPath},w9:function(){return isValidFormat},t7:function(){return lerp},bu:function(){return mutatePose},Zm:function(){return normaliseMaterialsConfig},DK:function(){return triggerCallback},Kx:function(){return useEmotion},xD:function(){return useFallback},Jr:function(){return useGltfLoader},bx:function(){return useHeadMovement}});var createClass=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),classCallCheck=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),regeneratorRuntime=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js"),asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),slicedToArray=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/slicedToArray.js"),react=__webpack_require__("./node_modules/react/index.js"),three_module=__webpack_require__("./node_modules/three/build/three.module.js"),index_673ef987_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js"),GLTFLoader=__webpack_require__("./node_modules/three-stdlib/loaders/GLTFLoader.js"),DRACOLoader=__webpack_require__("./node_modules/three-stdlib/loaders/DRACOLoader.js"),suspend_react=__webpack_require__("./node_modules/suspend-react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),getStoryAssetPath=function getStoryAssetPath(publicAsset){return"".concat("/visage","/").concat(publicAsset)},validateSource=function validateSource(source){if(Array.isArray(source))return source.length>0&&source.every(validateSource);if("string"==typeof source){var fileEndExpression=new RegExp(/(.glb|.fbx|.fbx[?].*|.glb[?].*)$/g),uploadFileExpression=new RegExp(/^data:application\/octet-stream;base64,/g),gltfModelExpression=new RegExp(/^data:model\/gltf-binary;base64,/g);return fileEndExpression.test(source)||uploadFileExpression.test(source)||gltfModelExpression.test(source)}return source instanceof Blob&&"model/gltf-binary"===source.type},isValidFormat=function isValidFormat(source){var isValid=validateSource(source);return isValid||console.warn("Provided GLB/FBX is invalid. Check docs for supported formats: https://github.com/readyplayerme/visage"),isValid},clamp=function clamp(value,max,min){return Math.min(Math.max(min,value),max)},lerp=function lerp(start,end){var time=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.05;return start*(1-time)+end*time},normaliseMaterialsConfig=function normaliseMaterialsConfig(materials,bloomConfig){Object.values(materials).forEach((function(material){var mat=material;mat.map&&(mat.map.minFilter=three_module.LinearFilter,mat.depthWrite=!0,mat.toneMapped=!1),mat.emissiveMap&&(mat.emissiveIntensity=(null==bloomConfig?void 0:bloomConfig.materialIntensity)||3.3)}))},useHeadMovement=function useHeadMovement(_ref){var nodes=_ref.nodes,_ref$isHalfBody=_ref.isHalfBody,isHalfBody=void 0!==_ref$isHalfBody&&_ref$isHalfBody,_ref$distance=_ref.distance,distance=void 0===_ref$distance?2:_ref$distance,_ref$activeRotation=_ref.activeRotation,activeRotation=void 0===_ref$activeRotation?.2:_ref$activeRotation,_ref$rotationMargin=_ref.rotationMargin,rotationMargin=void 0===_ref$rotationMargin?new three_module.Vector2(5,10):_ref$rotationMargin,_ref$enabled=_ref.enabled,enabled=void 0!==_ref$enabled&&_ref$enabled,rad=Math.PI/180,currentPos=new three_module.Vector2(0,0),targetPos=new three_module.Vector2(0,0),activeDistance=distance-(isHalfBody?1:0),eyeRotationOffsetX=isHalfBody?90*rad:0,neckBoneRotationOffsetX=(isHalfBody?-5:10)*rad,mapRange=function mapRange(value,inMin,inMax,outMin,outMax){return(clamp(value,inMax,inMin)-inMin)*(outMax-outMin)/(inMax-inMin)+outMin};(0,index_673ef987_esm.A)((function(state){if(enabled&&nodes.Neck&&nodes.Head&&nodes.RightEye&&nodes.LeftEye){var cameraToHeadDistance=state.camera.position.distanceTo(nodes.Head.position),cameraRotation=Math.abs(state.camera.rotation.z);cameraToHeadDistance<activeDistance&&cameraRotation<activeRotation?(targetPos.x=mapRange(state.mouse.y,-.5,1,rotationMargin.x*rad,-rotationMargin.x*rad),targetPos.y=mapRange(state.mouse.x,-.5,.5,-rotationMargin.y*rad,rotationMargin.y*rad)):targetPos.set(0,0),currentPos.x=lerp(currentPos.x,targetPos.x),currentPos.y=lerp(currentPos.y,targetPos.y),nodes.Neck.rotation.x=currentPos.x+neckBoneRotationOffsetX,nodes.Neck.rotation.y=currentPos.y,nodes.Head.rotation.x=currentPos.x,nodes.Head.rotation.y=currentPos.y,nodes.RightEye.rotation.x=currentPos.x-eyeRotationOffsetX,nodes.LeftEye.rotation.x=currentPos.x-eyeRotationOffsetX,isHalfBody?(nodes.RightEye.rotation.z=2*currentPos.y+Math.PI,nodes.LeftEye.rotation.z=2*currentPos.y+Math.PI):(nodes.RightEye.rotation.y=2*currentPos.y,nodes.LeftEye.rotation.y=2*currentPos.y)}}))},mutatePose=function mutatePose(targetNodes,sourceNodes){targetNodes&&sourceNodes&&Object.keys(targetNodes).forEach((function(key){if("Bone"===targetNodes[key].type&&sourceNodes[key]){var pos=sourceNodes[key].position;targetNodes[key].position.set(pos.x,pos.y,pos.z);var rot=sourceNodes[key].rotation;targetNodes[key].rotation.set(rot.x,rot.y,rot.z)}}))},useEmotion=function useEmotion(nodes,emotion){var meshes=Object.values(nodes).filter((function(item){return null==item?void 0:item.morphTargetInfluences})),resetEmotions=function resetEmotions(resetMeshes){resetMeshes.forEach((function(mesh){var _mesh$morphTargetInfl;null==mesh||null===(_mesh$morphTargetInfl=mesh.morphTargetInfluences)||void 0===_mesh$morphTargetInfl||_mesh$morphTargetInfl.forEach((function(_,index){mesh.morphTargetInfluences[index]=0}))}))};(0,index_673ef987_esm.A)((function(){emotion?(resetEmotions(meshes),meshes.forEach((function(mesh){Object.entries(emotion).forEach((function(_ref2){var _morphTargetDictionar,_ref3=(0,slicedToArray.Z)(_ref2,2),shape=_ref3[0],value=_ref3[1],shapeId=null===(_morphTargetDictionar=mesh.morphTargetDictionary)||void 0===_morphTargetDictionar?void 0:_morphTargetDictionar[shape];shapeId&&(mesh.morphTargetInfluences[shapeId]=value)}))}))):resetEmotions(meshes)}))},useGltfLoader=function useGltfLoader(source){return(0,suspend_react.Rq)((0,asyncToGenerator.Z)((0,regeneratorRuntime.Z)().mark((function _callee(){var loader,dracoLoader,buffer,gltf;return(0,regeneratorRuntime.Z)().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(loader=new GLTFLoader.E,(dracoLoader=new DRACOLoader._).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),loader.setDRACOLoader(dracoLoader),!(source instanceof Blob)){_context.next=11;break}return _context.next=7,source.arrayBuffer();case 7:return buffer=_context.sent,_context.next=10,loader.parseAsync(buffer,"");case 10:return _context.abrupt("return",_context.sent);case 11:return _context.next=13,loader.loadAsync(source);case 13:return gltf=_context.sent,_context.abrupt("return",gltf);case 15:case"end":return _context.stop()}}),_callee)}))),[source])},Transform=(0,createClass.Z)((function Transform(){(0,classCallCheck.Z)(this,Transform),this.scale=void 0,this.rotation=void 0,this.position=void 0,this.scale=new three_module.Vector3(1,1,1),this.rotation=new three_module.Euler(0,0,0),this.position=new three_module.Vector3(0,0,0)}));var useFallback=function useFallback(nodes,setter){return(0,react.useEffect)((function(){"function"==typeof setter&&setter(function buildFallback(nodes){var transform=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Transform;return(0,jsx_runtime.jsx)("group",{children:Object.keys(nodes).map((function(key){var node=nodes[key];return"SkinnedMesh"===node.type?(0,jsx_runtime.jsx)("skinnedMesh",{castShadow:!0,receiveShadow:!0,scale:transform.scale,position:transform.position,rotation:transform.rotation,geometry:node.geometry,material:node.material,skeleton:node.skeleton,morphTargetInfluences:node.morphTargetInfluences||[]},node.name):"Mesh"===node.type?(0,jsx_runtime.jsx)("mesh",{castShadow:!0,receiveShadow:!0,scale:transform.scale,position:transform.position,rotation:transform.rotation,geometry:node.geometry,material:node.material,morphTargetInfluences:node.morphTargetInfluences||[]},node.name):null}))})}(nodes))}),[setter,nodes])},triggerCallback=function triggerCallback(callback){"function"==typeof callback&&callback()}},"./src/state/spawnAtom.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{O:function(){return spawnState}});var spawnState=(0,__webpack_require__("./node_modules/jotai/esm/vanilla.mjs").cn)({onLoadedEffect:null,onLoadedAnimation:null})}}]);