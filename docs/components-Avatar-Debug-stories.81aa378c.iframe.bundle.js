"use strict";(self.webpackChunk_readyplayerme_visage=self.webpackChunk_readyplayerme_visage||[]).push([[877],{"./src/components/Avatar/Debug.stories.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Debug:function(){return Debug},__namedExportsOrder:function(){return __namedExportsOrder},default:function(){return Debug_stories}});var objectSpread2=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),react=__webpack_require__("./node_modules/react/index.js"),index_673ef987_esm=__webpack_require__("./node_modules/@react-three/fiber/dist/index-673ef987.esm.js");class Stats{constructor({logsPerSecond:logsPerSecond=20,samplesLog:samplesLog=100,samplesGraph:samplesGraph=10,precision:precision=2,minimal:minimal=!1,horizontal:horizontal=!0,mode:mode=0}={}){this.mode=mode,this.horizontal=horizontal,this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;opacity:0.9;z-index:10000;",minimal&&(this.container.style.cssText+="cursor:pointer"),this.canvasGpu=null,this.gl=null,this.query=null,this.minimal=minimal,this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.frames=0,this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.queryCreated=!1,this.fpsPanel=this.addPanel(new Stats.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new Stats.Panel("CPU","#0f0","#020"),1),this.gpuPanel=null,this.samplesLog=samplesLog,this.samplesGraph=samplesGraph,this.precision=precision,this.logsPerSecond=logsPerSecond,this.minimal?(this.container.addEventListener("click",(event=>{event.preventDefault(),this.showPanel(++this.mode%this.container.children.length)}),!1),this.mode=mode,this.showPanel(this.mode)):window.addEventListener("resize",(()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2)}))}resizePanel(panel,offset){panel.canvas.style.position="absolute",this.minimal?panel.canvas.style.display="none":(panel.canvas.style.display="block",this.horizontal?(panel.canvas.style.top="0px",panel.canvas.style.left=offset*panel.WIDTH/panel.PR+"px"):(panel.canvas.style.left="0px",panel.canvas.style.top=offset*panel.HEIGHT/panel.PR+"px"))}addPanel(panel,offset){return panel.canvas&&(this.container.appendChild(panel.canvas),this.resizePanel(panel,offset)),panel}showPanel(id){for(let i=0;i<this.container.children.length;i++){this.container.children[i].style.display=i===id?"block":"none"}this.mode=id}init(canvas){this.canvasGpu=canvas,this.canvasGpu&&(this.gl=this.canvasGpu.getContext("webgl2"),this.ext=this.gl?this.gl.getExtension("EXT_disjoint_timer_query_webgl2"):null,this.ext&&(this.gpuPanel=this.addPanel(new Stats.Panel("GPU","#ff0","#220"),2)))}begin(){if(this.beginProfiling("cpu-started"),this.gl&&this.ext){if(this.query){const available=this.gl.getQueryParameter(this.query,this.gl.QUERY_RESULT_AVAILABLE);if(this.disjoint=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT),available&&!this.disjoint){this.ns=this.gl.getQueryParameter(this.query,this.gl.QUERY_RESULT);const ms=1e-6*this.ns;(available||this.disjoint)&&(this.gl.deleteQuery(this.query),this.query=null),available&&this.addToAverage(ms,this.averageGpu)}}this.query||(this.queryCreated=!0,this.query=this.gl.createQuery(),this.query&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.query))}}end(){this.beginTime=this.endInternal(),this.endProfiling("cpu-started","cpu-finished","cpu-duration",this.averageCpu),this.gl&&this.ext&&this.queryCreated&&this.gl.getQuery(this.ext.TIME_ELAPSED_EXT,this.gl.CURRENT_QUERY)&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT)}endInternal(){this.frames++;const time=(performance||Date).now();if(time>=this.prevCpuTime+1e3/this.logsPerSecond&&(this.updatePanel(this.msPanel,this.averageCpu),this.updatePanel(this.gpuPanel,this.averageGpu),this.prevCpuTime=time),time>=this.prevTime+1e3){const fps=1e3*this.frames/(time-this.prevTime);this.fpsPanel.update(fps,fps,100,100,0),this.prevTime=time,this.frames=0}return time}addToAverage(value,averageArray){averageArray.logs.push(value),averageArray.logs.length>this.samplesLog&&averageArray.logs.shift(),averageArray.graph.push(value),averageArray.graph.length>this.samplesGraph&&averageArray.graph.shift()}beginProfiling(marker){window.performance&&window.performance.mark(marker)}endProfiling(startMarker,endMarker,measureName,averageArray){if(window.performance&&endMarker){window.performance.mark(endMarker);const cpuMeasure=performance.measure(measureName,startMarker,endMarker);this.addToAverage(cpuMeasure.duration,averageArray)}}updatePanel(panel,averageArray){if(averageArray.logs.length>0){let sumLog=0,max=.01;for(let i=0;i<averageArray.logs.length;i++)sumLog+=averageArray.logs[i],averageArray.logs[i]>max&&(max=averageArray.logs[i]);let sumGraph=0,maxGraph=.01;for(let i=0;i<averageArray.graph.length;i++)sumGraph+=averageArray.graph[i],averageArray.graph[i]>maxGraph&&(maxGraph=averageArray.graph[i]);panel&&panel.update(sumLog/Math.min(averageArray.logs.length,this.samplesLog),sumGraph/Math.min(averageArray.graph.length,this.samplesGraph),max,maxGraph,this.precision)}}}function StatsGl({className:className,parent:parent,...props}){const gl=(0,index_673ef987_esm.z)((state=>state.gl)),stats=react.useMemo((()=>{const stats=new Stats({...props});return stats.init(gl.domElement),stats}),[gl]);return react.useEffect((()=>{if(stats){const node=parent&&parent.current||document.body;null==node||node.appendChild(stats.container),className&&stats.container.classList.add(...className.split(" ").filter((cls=>cls)));const begin=(0,index_673ef987_esm.n)((()=>stats.begin())),end=(0,index_673ef987_esm.o)((()=>stats.end()));return()=>{null==node||node.removeChild(stats.container),begin(),end()}}}),[parent,stats,className]),null}Stats.Panel=class Panel{constructor(name,fg,bg){this.name=name,this.fg=fg,this.bg=bg,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=90*this.PR,this.canvas.height=48*this.PR,this.canvas.style.width="90px",this.canvas.style.position="absolute",this.canvas.style.height="48px",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(value,valueGraph,maxValue,maxGraph,decimals=0){let min=1/0,max=0;this.context&&(min=Math.min(min,value),max=Math.max(maxValue,value),maxGraph=Math.max(maxGraph,valueGraph),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(value.toFixed(decimals)+" "+this.name+" ("+min.toFixed(decimals)+"-"+parseFloat(max.toFixed(decimals))+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,(1-valueGraph/maxGraph)*this.GRAPH_HEIGHT))}};var _Debug$parameters,_Debug$parameters2,_Debug$parameters2$do,three_module=__webpack_require__("./node_modules/three/build/three.module.js"),components_Avatar=__webpack_require__("./src/components/Avatar/index.ts"),services=__webpack_require__("./src/services/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js"),Avatar=function Avatar(args){return(0,jsx_runtime.jsx)(components_Avatar.q,(0,objectSpread2.Z)((0,objectSpread2.Z)({},args),{},{children:(0,jsx_runtime.jsx)(StatsGl,{})}))},Debug_stories={component:Avatar},Debug=function Template(args){return(0,jsx_runtime.jsx)(Avatar,(0,objectSpread2.Z)({style:{background:"rgb(9,20,26)"}},args))}.bind({});Debug.args={modelSrc:(0,services.gT)("female.glb"),animationSrc:void 0,poseSrc:void 0,environment:"hub",scale:1,shadows:!0,idleRotation:!1,headMovement:!1,ambientLightColor:"#fff5b6",dirLightColor:"#002aff",spotLightColor:"#fff5b6",ambientLightIntensity:.25,dirLightIntensity:5,spotLightIntensity:1,dirLightPosition:new three_module.Vector3(-3,5,-5),spotLightPosition:new three_module.Vector3(12,10,7.5),spotLightAngle:.314,onLoaded:function onLoaded(){return console.info("EVENT: static avatar loaded")},onLoading:function onLoading(){return console.info("EVENT: loading static avatar")}},Debug.parameters=(0,objectSpread2.Z)((0,objectSpread2.Z)({},Debug.parameters),{},{docs:(0,objectSpread2.Z)((0,objectSpread2.Z)({},null===(_Debug$parameters=Debug.parameters)||void 0===_Debug$parameters?void 0:_Debug$parameters.docs),{},{source:(0,objectSpread2.Z)({originalSource:"args => <Avatar style={{\n  background: 'rgb(9,20,26)'\n}} {...args} />"},null===(_Debug$parameters2=Debug.parameters)||void 0===_Debug$parameters2||null===(_Debug$parameters2$do=_Debug$parameters2.docs)||void 0===_Debug$parameters2$do?void 0:_Debug$parameters2$do.source)})});var __namedExportsOrder=["Debug"]}}]);